I"B9<p>COSMOS supports sharing and reusing targets and tools by bundling the target and tool configuration and code into Ruby gems.
This document provides the information necessary to use and create gem based targets and tools.</p>

<h2 id="using-gem-based-targets">Using Gem Based Targets</h2>

<p>Step one is to install the gem based target into you COSMOS project by adding a line like the following to your project Gemfile:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'cosmos-xxxxxx'</span> <span class="c1"># Name of your gem here.  All should start with cosmos-</span></code></pre></figure>

<p>After making the Gemfile modification above, you can install the gem by running <code class="language-plaintext highlighter-rouge">bundle install</code> in your COSMOS project folder.  Note if the gem is not hosted at rubygems.org and you just have the file locally, you will most likely need to manually <code class="language-plaintext highlighter-rouge">gem install cosmos-xxxxxxx.gem</code> before running <code class="language-plaintext highlighter-rouge">bundle install</code>.</p>

<p>Step two is to let the COSMOS system know about the gem based target in config/system/system.txt:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># system.txt</span>

<span class="c"># Declare all installed gem based targets in your Gemfile</span>
AUTO_DECLARE_TARGETS <span class="c"># This will discover any gem based targets automatically</span>

<span class="c"># Individually specify targets (and possibly rename)</span>
DECLARE_GEM_TARGET cosmos-xxxxxx</code></pre></figure>

<p>Step three is to configure the interface to the target in config/tools/cmd_tlm_server/cmd_tlm_server.txt.  This is done exactly the same way as any other target.</p>

<p>Step four is to configure telemetry screens in config/tools/tlm_viewer/tlm_viewer.txt.  This is again done exactly the same way as any other target.</p>

<p>That’s it!  You should now be able to connect and interact with your gem based target.</p>

<h2 id="using-gem-based-tools">Using Gem Based Tools</h2>

<p>First, install the gem based tool into your COSMOS project in the same way as installing a target gem above.  Then you will need to tell the COSMOS Launcher about the tool in launcher.txt like so:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># launcher.txt</span>

<span class="c"># Provide buttons for all gem based tools</span>
AUTO_GEM_TOOLS

<span class="c"># Or a just specific one</span>
TOOL <span class="s2">"XXXXXX"</span> <span class="s2">"LAUNCH_GEM Xxxxxx"</span> <span class="s2">"xxxxxxx.png"</span></code></pre></figure>

<p>That’s it!  Click the new button in launcher to launch the tool.</p>

<h2 id="creating-gem-based-targets">Creating Gem Based Targets</h2>

<p>Creating gem based targets is easy. All that is required is creating a cosmos-xxxxxx.gemspec (replace xxxxxxx with your target name) file in the target folder you wish to make into a gem.
The folder structure should be just like what is in a normal target folder (ie.):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">├── cosmos-xxxxxx.gemspec
├── cmd_tlm_server.txt
├── target.txt
├── cmd_tlm
|  └── <span class="c"># Target command and telemetry definition files here</span>
├── lib
|  └── <span class="c"># Any necessary target code here</span>
└── screens
|  └── <span class="c"># Target telemetry screen files</span></code></pre></figure>

<p>The gem name must start with “cosmos-“, and should then be followed by the actual target name.  For example: cosmos-apcpdu.gemspec could be the gem name for a target called APCPDU.</p>

<p>Example config/targets/XXXXXX/cosmos-xxxxxx.gemspec file:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># encoding: ascii-8bit</span>

<span class="nb">require</span> <span class="s1">'rbconfig'</span>

<span class="c1"># Create the overall gemspec</span>
<span class="n">spec</span> <span class="o">=</span> <span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s1">'cosmos-xxxxxx'</span> <span class="c1"># UPDATE WITH YOUR GEM NAME (must start with cosmos-)</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">summary</span> <span class="o">=</span> <span class="s1">'Ball Aerospace COSMOS target'</span> <span class="c1"># UPDATE</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span>  <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
    Example gem based target # UPDATE
</span><span class="no">  EOF</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">authors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Your Name'</span><span class="p">]</span> <span class="c1"># UPDATE</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">email</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'yourname@yourcompany.com'</span><span class="p">]</span> <span class="c1"># UPDATE</span>

  <span class="n">s</span><span class="p">.</span><span class="nf">platform</span> <span class="o">=</span> <span class="no">Gem</span><span class="o">::</span><span class="no">Platform</span><span class="o">::</span><span class="no">RUBY</span>
  <span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'VERSION'</span><span class="p">]</span>
    <span class="n">s</span><span class="p">.</span><span class="nf">version</span> <span class="o">=</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'VERSION'</span><span class="p">].</span><span class="nf">dup</span>
  <span class="k">else</span>
    <span class="n">s</span><span class="p">.</span><span class="nf">version</span> <span class="o">=</span> <span class="s1">'0.0.0'</span>
  <span class="k">end</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">license</span> <span class="o">=</span> <span class="s1">'GPL-3.0'</span> <span class="c1"># UPDATE</span>

  <span class="c1"># Modify as needed</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">files</span> <span class="o">=</span> <span class="no">Dir</span><span class="p">[</span><span class="s1">'lib/*'</span><span class="p">]</span> <span class="o">+</span> <span class="no">Dir</span><span class="p">[</span><span class="s1">'cmd_tlm/*'</span><span class="p">]</span> <span class="o">+</span> <span class="no">Dir</span><span class="p">[</span><span class="s1">'screens/*'</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">'cmd_tlm_server.txt'</span><span class="p">,</span> <span class="s1">'target.txt'</span><span class="p">]</span>

  <span class="n">s</span><span class="p">.</span><span class="nf">has_rdoc</span> <span class="o">=</span> <span class="kp">true</span>

  <span class="n">s</span><span class="p">.</span><span class="nf">required_ruby_version</span> <span class="o">=</span> <span class="s1">'~&gt; 2'</span>

  <span class="c1"># Runtime Dependencies</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">add_runtime_dependency</span> <span class="s1">'cosmos'</span><span class="p">,</span> <span class="s1">'~&gt; 3'</span><span class="p">,</span> <span class="s1">'&gt;= 3.7.0'</span>
<span class="k">end</span></code></pre></figure>

<p>After organizing the files as required and creating the gemspec, create the actual gem with the following:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Windows - update VERSION as needed</span>
<span class="nb">set </span><span class="nv">VERSION</span><span class="o">=</span>1.0.0
gem build cosmos-xxxxxx.gemspec

<span class="c"># Linux/Mac - update VERSION as needed</span>
<span class="nb">export </span><span class="nv">VERSION</span><span class="o">=</span>1.0.0
gem build cosmos-xxxxxx.gemspec</code></pre></figure>

<p>To publish your gem for other COSMOS users consider putting the source on <a href="https://www.github.com">Github</a> and publishing your gem to <a href="http://guides.rubygems.org/publishing/">Rubygems</a>.</p>

<h2 id="creating-gem-based-tools">Creating Gem Based Tools</h2>

<p>Creating a gem based tool is very similar to creating a gem based target.   However, generally it will need to be done outside of your COSMOS project folder otherwise careful crafting in the “files” section of the gemspec file is required.
In general, you will need to create a cosmos-xxxxxx.gemspec (replace xxxxxx with your tool name) file and a directory structure like this:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">├── cosmos-xxxxxx.gemspec
├── config
|  └── data
|   |   └── xxxxxx.png <span class="c"># Tool icon</span>
├── lib
|  └── <span class="c"># Tool code files</span>
├── tools
   └── Xxxxxx <span class="c"># Tool starting script (see Launcher, etc)</span>
   └── mac
      └── Xxxxxx <span class="c"># Mac Tool starting script (see Launcher.app, etc)</span></code></pre></figure>

<p>The gem name must start with “cosmos-“, and should then be followed by the actual tool name.  For example: cosmos-satvis.gemspec could be the gem name for a tool called Satvis.</p>

<p>Example cosmos-xxxxxx.gemspec file for a tool:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># encoding: ascii-8bit</span>

<span class="nb">require</span> <span class="s1">'rbconfig'</span>

<span class="c1"># Create the overall gemspec</span>
<span class="n">spec</span> <span class="o">=</span> <span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s1">'cosmos-xxxxxx'</span> <span class="c1"># UPDATE WITH YOUR GEM NAME (must start with cosmos-)</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">summary</span> <span class="o">=</span> <span class="s1">'Ball Aerospace COSMOS based tool'</span> <span class="c1"># UPDATE</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span>  <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
    Example gem based tool # UPDATE
</span><span class="no">  EOF</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">authors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Your Name'</span><span class="p">]</span> <span class="c1"># UPDATE</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">email</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'yourname@yourcompany.com'</span><span class="p">]</span> <span class="c1"># UPDATE</span>

  <span class="n">s</span><span class="p">.</span><span class="nf">platform</span> <span class="o">=</span> <span class="no">Gem</span><span class="o">::</span><span class="no">Platform</span><span class="o">::</span><span class="no">RUBY</span>
  <span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'VERSION'</span><span class="p">]</span>
    <span class="n">s</span><span class="p">.</span><span class="nf">version</span> <span class="o">=</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'VERSION'</span><span class="p">].</span><span class="nf">dup</span>
  <span class="k">else</span>
    <span class="n">s</span><span class="p">.</span><span class="nf">version</span> <span class="o">=</span> <span class="s1">'0.0.0'</span>
  <span class="k">end</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">license</span> <span class="o">=</span> <span class="s1">'GPL-3.0'</span> <span class="c1"># UPDATE</span>

  <span class="c1"># Modify as needed</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">files</span> <span class="o">=</span> <span class="no">Dir</span><span class="p">[</span><span class="s1">'config/data/*'</span><span class="p">]</span> <span class="o">+</span> <span class="no">Dir</span><span class="p">[</span><span class="s1">'lib/*'</span><span class="p">]</span> <span class="o">+</span> <span class="no">Dir</span><span class="p">[</span><span class="s1">'tools/**/*'</span><span class="p">]</span>

  <span class="n">s</span><span class="p">.</span><span class="nf">has_rdoc</span> <span class="o">=</span> <span class="kp">true</span>

  <span class="n">s</span><span class="p">.</span><span class="nf">required_ruby_version</span> <span class="o">=</span> <span class="s1">'~&gt; 2'</span>

  <span class="c1"># Runtime Dependencies</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">add_runtime_dependency</span> <span class="s1">'cosmos'</span><span class="p">,</span> <span class="s1">'~&gt; 3'</span><span class="p">,</span> <span class="s1">'&gt;= 3.7.0'</span>
<span class="k">end</span></code></pre></figure>

<p>After organizing the files as required and creating the gemspec, create the actual gem with the following:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Windows - update VERSION as needed</span>
<span class="nb">set </span><span class="nv">VERSION</span><span class="o">=</span>1.0.0
gem build cosmos-xxxxxx.gemspec

<span class="c"># Linux/Mac - update VERSION as needed</span>
<span class="nb">export </span><span class="nv">VERSION</span><span class="o">=</span>1.0.0
gem build cosmos-xxxxxx.gemspec</code></pre></figure>

<p>To publish your gem for other COSMOS users consider putting the source on <a href="https://www.github.com">Github</a> and publishing your gem to <a href="http://guides.rubygems.org/publishing/">Rubygems</a>.</p>
:ET